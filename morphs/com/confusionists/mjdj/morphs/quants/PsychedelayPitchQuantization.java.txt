package com.confusionists.mjdj.morphs.quants;
import java.util.List;

import javax.sound.midi.ShortMessage;

import com.confusionists.mjdj.api.DeviceNotFoundException;
import com.confusionists.mjdj.api.MessageWrapper;
import com.confusionists.mjdj.api.MorphWithFilter;

public abstract class PsychedelayPitchQuantization extends MorphWithFilter {

    public int getMatchGroup() {
        return MATCHES_DEVICE + MATCHES_CHANNEL + MATCHES_COMMAND + MATCHES_CC_NUMBER;
    }

    @Override
    public void init(List<String> deviceNames) throws DeviceNotFoundException {
    }

    @Override
    public boolean process(MessageWrapper message, String from) throws Exception {
        if (filter(message)) {
            ShortMessage sMessage = message.getShortMessage();
            int value = sMessage.getData2();

            if (value < 57 || value > 71)
                return false;

            int[] values = {0, 10, 20, 25, 35, 50, 60, 65, 75, 85, 90, 100, 110, 120, 127};

            value = value - 57;

            value = values[value];

            // otherwise it's the value
            message.alter(value);
            service.send(message);
            return true;
        }
        return false;

    }
    
	@Override
	public String diagnose() {
		// TODO Auto-generated method stub
		return null;
	}
    
}
