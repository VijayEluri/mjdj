package com.confusionists.mjdj.morphs.quants;
import java.util.List;

import com.confusionists.mjdj.api.DeviceNotFoundException;
import com.confusionists.mjdj.api.MessageWrapper;
import com.confusionists.mjdj.api.MorphWithFilter;


public abstract class PsychedelayTimeQuantization extends MorphWithFilter {

	
	@Override
	public void init(List<String> deviceNames) throws DeviceNotFoundException {
	}

	@Override
	public boolean process(MessageWrapper message, String from) throws Exception {
		if (filter(message)) {
			int value = message.getShortMessage().getData2();
			if (value > 116)
				value = 116;
			else if (value > 102)
				value = 102;
			else if (value > 96)
				value = 96;
			else if (value > 72)
				value = 72;
			else if (value > 60)
				value = 60;
			else if (value > 52)
				value = 52;
			// otherwise it's the value
			message.alter(value);
			service.send(message);
			return true;
		}
		return false;

	}
	
	public int getMatchGroup() {
		return MATCHES_COMMAND + MATCHES_CHANNEL + MATCHES_CC_NUMBER + MATCHES_DEVICE;
	}
	
	@Override
	public String diagnose() {
		// TODO Auto-generated method stub
		return null;
	}

}
